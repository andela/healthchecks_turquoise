machine:
  python:
    version: 3.5.2
    
  services:
    - postgresql
  
  environment:
    DB : "postgres"

dependencies:
  pre:
    - pip install --upgrade pip

  override:
    - pip install -r requirements.txt
    - pip install mock
    
deployment:
  staging:
    branch: develop
    commands:
      - HEROKU_API_KEY=$HEROKU_API_KEY_STAGING heroku maintenance:on --app healthchecks-turquoise-staging
      - git push git@heroku.com:healthchecks-turquoise-staging.git $CIRCLE_SHA1:refs/heads/master --force
      - HEROKU_API_KEY=$HEROKU_API_KEY_STAGING heroku run python manage.py migrate --app healthchecks-turquoise-staging
      - HEROKU_API_KEY=$HEROKU_API_KEY_STAGING heroku maintenance:off --app healthchecks-turquoise-staging

  production:
    branch: master
    commands:
      - HEROKU_API_KEY=$HEROKU_API_KEY_PROD heroku maintenance:on --app healthchecks-turquoise-prod
      - git push git@heroku.com:healthchecks-turquoise-prod.git $CIRCLE_SHA1:refs/heads/master --force
      - HEROKU_API_KEY=$HEROKU_API_KEY_PROD heroku run python manage.py migrate --app healthchecks-turquoise-prod
      - HEROKU_API_KEY=$HEROKU_API_KEY_PROD heroku maintenance:off --app healthchecks-turquoise-prod


